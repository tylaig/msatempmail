üìò PRD ‚Äî Plataforma de E-mails Tempor√°rios com Haraka SMTP + API pr√≥pria

Vers√£o: 1.0
Respons√°vel: Samuel (Founder / Vision√°rio / Dono do dom√≠nio do caos)
Arquitetura principal: Haraka (SMTP), Node.js/Bun (API), Redis (Storage TTL), Next.js 15 (Frontend), Docker Compose (Infra)

1. Vis√£o Geral do Produto

A plataforma ser√° um provedor completo de e-mails tempor√°rios com dom√≠nio pr√≥prio, totalmente independente de servi√ßos terceiros, oferecendo:

Servidor SMTP real (entrada) via Haraka

Valida√ß√£o DKIM, SPF e DMARC

Gera√ß√£o de e-mails tempor√°rios com TTL

Armazenamento e leitura de mensagens via API REST/WebSocket

Interface moderna estilo TempMail, mas high-tech/clean

Infra pr√≥pria para isolamento, privacidade e performance

Suporte multi-dom√≠nio no futuro

O sistema permitir√° que usu√°rios criem e-mails descart√°veis para receber c√≥digos, cadastros e testes, diretamente sob seu pr√≥prio dom√≠nio.

2. Objetivo Principal

Criar um sistema completo de Recep√ß√£o, Armazenamento, Exibi√ß√£o e Descarte Autom√°tico de e-mails recebidos via dom√≠nio configurado com MX pr√≥prio, sem depender de solu√ß√µes externas.

O sistema deve ser:

R√°pido (lat√™ncia quase instant√¢nea)

Seguro (focado em privacidade e isolamento)

F√°cil de escalar

Fac√≠limo de integrar com qualquer SaaS futuro do Samuel

3. P√∫blico-alvo

Usu√°rios que querem e-mails descart√°veis

Desenvolvedores que precisam testar fluxos de verifica√ß√£o

Donos de neg√≥cio que n√£o querem depender de TempMail/Guerrilla Mail

Internamente: qualquer produto do Samuel que necessite dessa funcionalidade

4. Proposta de Valor

Infra pr√≥pria = zero riscos de perda de servi√ßo

Alta privacidade (n√£o indexado, isolado, n√£o rastreado)

Recep√ß√£o em tempo real via WebSocket

Dom√≠nio pr√≥prio com DKIM configurado para evitar SPAM Folder

Estilo TempMail premium com UX moderna

5. Arquitetura T√©cnica
üîπ 5.1 Componentes Principais
Haraka SMTP Server

Recebe todos os e-mails enviados ao dom√≠nio ou subdom√≠nio (ex: @inbox.meusuper.app)

Plugins principais:

save_to_api.js: Enviar JSON do e-mail para API

dkim_sign (para dom√≠nios que enviarem no futuro)

dnsbl (opcional)

rcpt_to.in_host_list (filtrar apenas dom√≠nios aceitos)

access (anti-abuso)

Porta: 25 (entrada)

API Backend (Node.js / Bun + Elysia)

Respons√°vel por:

Criar e-mails tempor√°rios

Registrar mensagens recebidas

Fornecer inbox via REST

Enviar mensagens em tempo real via WebSockets (inbox live)

Gerenciar TTL das caixas

Autentica√ß√£o interna (via API Key entre Haraka ‚Üí API)

Endpoints:

M√©todo	Rota	Fun√ß√£o
POST	/mailbox/create	Cria uma caixa tempor√°ria
GET	/mailbox/:address	Lista mensagens
GET	/message/:id	Mostra mensagem completa
POST	/internal/save-email	Endpoint privado para o Haraka salvar e-mails
DELETE	/mailbox/:address	Expira caixa manualmente
WS	/ws/inbox/:address	Stream em tempo real
Redis (Armazenamento + TTL)

Estrutura:

mailbox:<email> {
   ttl: timestamp,
   messages: [ids]
}

message:<id> {
   from,
   to,
   subject,
   text,
   html,
   date
}


TTL autom√°tico via Redis expire.

Frontend (Next.js 15)

UI moderna estilo TempMail

Gera√ß√£o instant√¢nea de endere√ßo

Copiar para √°rea de transfer√™ncia

Inbox autom√°tica (SSE ou WebSocket)

Leitura da mensagem em modal

Tema minimalista e elegante (preto, branco, azul ou verde dependendo da marca)

Infra / DevOps

Docker Compose com:

haraka

api

redis

nginx (reverse proxy + TLS)

Firewall com porta 25 liberada

Domain DNS:

MX

SPF

DKIM (selector: mail)

DMARC com pol√≠tica none inicialmente

6. Fluxo de Funcionamento
üîπ 6.1 Gera√ß√£o da mailbox

Usu√°rio acessa frontend

Clica ‚ÄúGerar e-mail tempor√°rio‚Äù

API cria endere√ßo √∫nico e salva TTL no Redis

Front exibe endere√ßo e abre WebSocket para inbox

üîπ 6.2 Recep√ß√£o do e-mail

E-mail chega no Haraka via porta 25

Haraka identifica o dom√≠nio

Plugin save_to_api.js envia o conte√∫do + metadados para a API

API valida o endere√ßo

Armazena no Redis

API envia push pelo WebSocket para a sess√£o do usu√°rio

Inbox atualiza automaticamente

üîπ 6.3 Expira√ß√£o autom√°tica

Redis TTL dispara

Back-end remove mailbox

Mensagens associadas s√£o apagadas

Caso haja WebSocket aberto, usu√°rio v√™ ‚Äúcaixa expirada‚Äù

7. Requisitos Funcionais
RF-01 ‚Äî Criar caixa tempor√°ria

Deve gerar endere√ßo √∫nico (exemplo: a9f2b7@seudominio.com)

TTL configur√°vel (ex: 15 minutos)

Salvar endere√ßo no Redis

RF-02 ‚Äî Receber e-mails

Receber via Haraka

Repassar via API interna

Armazenar no Redis

Exibir em 1 segundo no frontend

RF-03 ‚Äî Listar mensagens

Exibir assunto, remetente, preview do body

RF-04 ‚Äî Ler mensagem completa

Exibir HTML seguro (sanitizado)

Mostrar headers b√°sicos

RF-05 ‚Äî Expira√ß√£o autom√°tica

Limpar mensagens e caixa ao expirar

RF-06 ‚Äî WebSocket live inbox

Mensagens novas devem aparecer instantaneamente

RF-07 ‚Äî DKIM

E-mails enviados do sistema (futuro) devem ser assinados

Recep√ß√£o deve validar assinatura no header (opcional)

8. Requisitos N√£o Funcionais
RNF-01 ‚Äî Seguran√ßa

Limitar tamanho m√°ximo de e-mail (50 KB)

Sanitizar HTML antes de exibir

TLS obrigat√≥rio no frontend/backend

API interna autenticada via Bearer Key

Rate-limit no endpoint de create mailbox

RNF-02 ‚Äî Performance

Inbox deve atualizar em < 1s

Suportar 1.000 e-mails simult√¢neos com lat√™ncia m√≠nima

RNF-03 ‚Äî Escalabilidade

Redis cluster√°vel

API stateless

Haraka pode ser escalado com balanceamento MX m√∫ltiplo

RNF-04 ‚Äî Observabilidade

Logs estruturados (pino.js)

M√©tricas com Prometheus + Grafana (opcional)

9. Roadmap
FASE 1 ‚Äî MVP (1 a 3 dias)

Subir Haraka com container

Configurar plugin save_to_api.js

Criar API m√≠nima:

salvar e-mail

listar inbox

criar mailbox

Redis integrado

Configurar dom√≠nio (MX/SPF)

Front simples com inbox atualizando a cada 5s

FASE 2 ‚Äî Beta (3 a 7 dias)

WebSocket para inbox real-time

HTML sanitizado

UI bonita estilo TempMail Pro

DKIM configurado e validado

Dashboard interno para logs

Controle de TTL e expira√ß√£o autom√°tica

FASE 3 ‚Äî Produ√ß√£o (7 a 14 dias)

Suporte multi-dom√≠nio

API Key para desenvolvedores

Modo privado (senha para caixa)

Exportar mensagem em .eml

Notifica√ß√µes push (opcional)

CDN para assets

10. Riscos & Mitiga√ß√µes
Risco	Poss√≠vel impacto	Mitiga√ß√£o
Porta 25 bloqueada	N√£o recebe e-mail	Usar VPS com 25 liberada (Hetzner / Contabo)
IP em blacklist	E-mails n√£o chegam	N√£o enviar nada pelo servidor
Abuso (uso massivo)	Queda de performance	Rate-limit + m√°x 1 mailbox ativa por IP
E-mails maliciosos	XSS	Sanitizar HTML
TTL n√£o limpo	Mem√≥ria do Redis explode	Cron de limpeza + Redis EXPIRE
11. Crit√©rios de Aceite

O MVP ser√° considerado pronto quando:

Caixa tempor√°ria √© criada e recebe e-mails pelo dom√≠nio

Haraka envia e-mails para a API corretamente

API armazena e retorna mensagens

Frontend mostra inbox funcionando

Expira√ß√£o funciona automaticamente

DKIM est√° ativo e validado

12. Entrega Final Esperada

Docker Compose FULL (Haraka + API + Redis + Nginx)

API documentada em Swagger ou Markdown

Interface funcional em Next.js

Configura√ß√µes de dom√≠nio prontas

Plugin de Haraka funcionando 100%

Sistema pronto para ser usado como SaaS futuramente